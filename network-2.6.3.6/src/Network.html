<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-warnings-deprecations #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      :  Network</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2001</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     :  BSD-style (see the file libraries/network/LICENSE)</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Portability :  portable</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- This module is kept for backwards-compatibility. New users are</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- encouraged to use &quot;Network.Socket&quot; instead.</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- &quot;Network&quot; was intended as a \&quot;higher-level\&quot; interface to networking</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- facilities, and only supports TCP.</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span class="hs-cpp">

#include &quot;HsNetworkConfig.h&quot;
</span><span class="hs-cpp">
#ifdef HAVE_GETADDRINFO
</span><span class="hs-comment">-- Use IPv6-capable function definitions if the OS supports it.</span><span class="hs-cpp">
#define IPV6_SOCKET_SUPPORT 1
</span><span class="hs-cpp">#endif
</span><span>
</span><span id="line-28"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Basic data types</span></span><span>
</span><span id="line-31"></span><span>      </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier">Socket</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#PortID"><span class="hs-identifier">PortID</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.html#HostName"><span class="hs-identifier">HostName</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#PortNumber"><span class="hs-identifier">PortNumber</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Initialisation</span></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Internal.html#withSocketsDo"><span class="hs-identifier">withSocketsDo</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Server-side connections</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#listenOn"><span class="hs-identifier">listenOn</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#accept"><span class="hs-identifier">accept</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#sClose"><span class="hs-identifier">sClose</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Client-side connections</span></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#connectTo"><span class="hs-identifier">connectTo</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Simple sending and receiving</span></span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="hs-comment">{-$sendrecv-}</span></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#sendTo"><span class="hs-identifier">sendTo</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#recvFrom"><span class="hs-identifier">recvFrom</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Miscellaneous</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.html#socketPort"><span class="hs-identifier">socketPort</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Networking Issues</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Buffering</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="hs-comment">{-$buffering-}</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Improving I\/O Performance over sockets</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-comment">{-$performance-}</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftM</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.BSD.html"><span class="hs-identifier">Network.BSD</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Socket.html"><span class="hs-identifier">Network.Socket</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.html#accept"><span class="hs-identifier">accept</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.html#socketPort"><span class="hs-identifier">socketPort</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.html#recvFrom"><span class="hs-identifier">recvFrom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>                              </span><span class="annot"><a href="Network.Socket.html#sendTo"><span class="hs-identifier">sendTo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#PortNumber"><span class="hs-identifier">PortNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Socket.html#sClose"><span class="hs-identifier">sClose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Network.Socket.html"><span class="hs-identifier">Network.Socket</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Socket</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.html#accept"><span class="hs-identifier">accept</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Exception</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- High Level ``Setup'' functions</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- If the @PortID@ specifies a unix family socket and the @Hostname@</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- differs from that returned by @getHostname@ then an error is</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- raised. Alternatively an empty string may be given to @connectTo@</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- signalling that the current hostname applies.</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="PortID"><span class="annot"><a href="Network.html#PortID"><span class="hs-identifier hs-var">PortID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>          </span><span id="Service"><span class="annot"><a href="Network.html#Service"><span class="hs-identifier hs-var">Service</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                </span><span class="hs-comment">-- Service Name eg &quot;ftp&quot;</span><span>
</span><span id="line-83"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="PortNumber"><span class="annot"><a href="Network.html#PortNumber"><span class="hs-identifier hs-var">PortNumber</span></a></span></span><span> </span><span class="annot"><a href="Network.Socket.Types.html#PortNumber"><span class="hs-identifier hs-type">PortNumber</span></a></span><span>         </span><span class="hs-comment">-- User defined Port Number</span><span class="hs-cpp">
#if !defined(mingw32_HOST_OS)
</span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="UnixSocket"><span class="annot"><a href="Network.html#UnixSocket"><span class="hs-identifier hs-var">UnixSocket</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>             </span><span class="hs-comment">-- Unix family socket in file system</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073601"><span id="local-6989586621679073603"><span id="local-6989586621679073605"><span class="annot"><span class="annottext">Int -&gt; PortID -&gt; ShowS
[PortID] -&gt; ShowS
PortID -&gt; String
(Int -&gt; PortID -&gt; ShowS)
-&gt; (PortID -&gt; String) -&gt; ([PortID] -&gt; ShowS) -&gt; Show PortID
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PortID] -&gt; ShowS
$cshowList :: [PortID] -&gt; ShowS
show :: PortID -&gt; String
$cshow :: PortID -&gt; String
showsPrec :: Int -&gt; PortID -&gt; ShowS
$cshowsPrec :: Int -&gt; PortID -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073596"><span id="local-6989586621679073598"><span class="annot"><span class="annottext">PortID -&gt; PortID -&gt; Bool
(PortID -&gt; PortID -&gt; Bool)
-&gt; (PortID -&gt; PortID -&gt; Bool) -&gt; Eq PortID
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PortID -&gt; PortID -&gt; Bool
$c/= :: PortID -&gt; PortID -&gt; Bool
== :: PortID -&gt; PortID -&gt; Bool
$c== :: PortID -&gt; PortID -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Calling 'connectTo' creates a client side socket which is</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- connected to the given host and port.  The Protocol and socket type is</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- derived from the given port identifier.  If a port number is given</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- then the result is always an internet family 'Stream' socket.</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Network.html#connectTo"><span class="hs-identifier hs-type">connectTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Socket.html#HostName"><span class="hs-identifier hs-type">HostName</span></a></span><span>           </span><span class="hs-comment">-- Hostname</span><span>
</span><span id="line-95"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.html#PortID"><span class="hs-identifier hs-type">PortID</span></a></span><span>             </span><span class="hs-comment">-- Port Identifier</span><span>
</span><span id="line-96"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>          </span><span class="hs-comment">-- Connected Socket</span><span class="hs-cpp">

#if defined(IPV6_SOCKET_SUPPORT)
</span><span class="hs-comment">-- IPv6 and IPv4.</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span id="connectTo"><span class="annot"><span class="annottext">connectTo :: String -&gt; PortID -&gt; IO Handle
</span><a href="Network.html#connectTo"><span class="hs-identifier hs-var hs-var">connectTo</span></a></span></span><span> </span><span id="local-6989586621679073594"><span class="annot"><span class="annottext">hostname :: String
</span><a href="#local-6989586621679073594"><span class="hs-identifier hs-var">hostname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.html#Service"><span class="hs-identifier hs-type">Service</span></a></span><span> </span><span id="local-6989586621679073593"><span class="annot"><span class="annottext">serv :: String
</span><a href="#local-6989586621679073593"><span class="hs-identifier hs-var">serv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; IO Handle
</span><a href="Network.html#connect%27"><span class="hs-identifier hs-var">connect'</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Network.connectTo&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073594"><span class="hs-identifier hs-var">hostname</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073593"><span class="hs-identifier hs-var">serv</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="annot"><a href="Network.html#connectTo"><span class="hs-identifier hs-var">connectTo</span></a></span><span> </span><span id="local-6989586621679073591"><span class="annot"><span class="annottext">hostname :: String
</span><a href="#local-6989586621679073591"><span class="hs-identifier hs-var">hostname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.html#PortNumber"><span class="hs-identifier hs-type">PortNumber</span></a></span><span> </span><span id="local-6989586621679073590"><span class="annot"><span class="annottext">port :: PortNumber
</span><a href="#local-6989586621679073590"><span class="hs-identifier hs-var">port</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; IO Handle
</span><a href="Network.html#connect%27"><span class="hs-identifier hs-var">connect'</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Network.connectTo&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073591"><span class="hs-identifier hs-var">hostname</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PortNumber -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073590"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-comment">-- IPv4 only.</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-identifier">connectTo</span><span> </span><span class="hs-identifier">hostname</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Service</span><span> </span><span class="hs-identifier">serv</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-identifier">proto</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getProtocolNumber</span><span> </span><span class="hs-string">&quot;tcp&quot;</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-identifier">bracketOnError</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">socket</span><span> </span><span class="hs-identifier">AF_INET</span><span> </span><span class="hs-identifier">Stream</span><span> </span><span class="hs-identifier">proto</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">sClose</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- only done if there's an error</span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">sock</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>          </span><span class="hs-identifier">port</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getServicePortNumber</span><span> </span><span class="hs-identifier">serv</span><span>
</span><span id="line-114"></span><span>          </span><span class="hs-identifier">he</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getHostByName</span><span> </span><span class="hs-identifier">hostname</span><span>
</span><span id="line-115"></span><span>          </span><span class="hs-identifier">connect</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SockAddrInet</span><span> </span><span class="hs-identifier">port</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hostAddress</span><span> </span><span class="hs-identifier">he</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>          </span><span class="hs-identifier">socketToHandle</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-identifier">ReadWriteMode</span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-identifier">connectTo</span><span> </span><span class="hs-identifier">hostname</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PortNumber</span><span> </span><span class="hs-identifier">port</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-identifier">proto</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getProtocolNumber</span><span> </span><span class="hs-string">&quot;tcp&quot;</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-identifier">bracketOnError</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">socket</span><span> </span><span class="hs-identifier">AF_INET</span><span> </span><span class="hs-identifier">Stream</span><span> </span><span class="hs-identifier">proto</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">sClose</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- only done if there's an error</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">sock</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>          </span><span class="hs-identifier">he</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getHostByName</span><span> </span><span class="hs-identifier">hostname</span><span>
</span><span id="line-126"></span><span>          </span><span class="hs-identifier">connect</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SockAddrInet</span><span> </span><span class="hs-identifier">port</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hostAddress</span><span> </span><span class="hs-identifier">he</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>          </span><span class="hs-identifier">socketToHandle</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-identifier">ReadWriteMode</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if !defined(mingw32_HOST_OS)
</span><span class="annot"><a href="Network.html#connectTo"><span class="hs-identifier hs-var">connectTo</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.html#UnixSocket"><span class="hs-identifier hs-type">UnixSocket</span></a></span><span> </span><span id="local-6989586621679073588"><span class="annot"><span class="annottext">path :: String
</span><a href="#local-6989586621679073588"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">IO Socket
-&gt; (Socket -&gt; IO ()) -&gt; (Socket -&gt; IO Handle) -&gt; IO Handle
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="Network.html#bracketOnError"><span class="hs-identifier hs-var">bracketOnError</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Family -&gt; SocketType -&gt; ProtocolNumber -&gt; IO Socket
</span><a href="Network.Socket.html#socket"><span class="hs-identifier hs-var">socket</span></a></span><span> </span><span class="annot"><span class="annottext">Family
</span><a href="Network.Socket.Types.html#AF_UNIX"><span class="hs-identifier hs-var">AF_UNIX</span></a></span><span> </span><span class="annot"><span class="annottext">SocketType
</span><a href="Network.Socket.Types.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="Network.html#sClose"><span class="hs-identifier hs-var">sClose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679073583"><span class="annot"><span class="annottext">sock :: Socket
</span><a href="#local-6989586621679073583"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>          </span><span class="annot"><span class="annottext">Socket -&gt; SockAddr -&gt; IO ()
</span><a href="Network.Socket.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073583"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SockAddr
</span><a href="Network.Socket.Types.html#SockAddrUnix"><span class="hs-identifier hs-var">SockAddrUnix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073588"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>          </span><span class="annot"><span class="annottext">Socket -&gt; IOMode -&gt; IO Handle
</span><a href="Network.Socket.html#socketToHandle"><span class="hs-identifier hs-var">socketToHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073583"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadWriteMode</span></span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if defined(IPV6_SOCKET_SUPPORT)
</span><span class="annot"><a href="Network.html#connect%27"><span class="hs-identifier hs-type">connect'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Socket.html#HostName"><span class="hs-identifier hs-type">HostName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Socket.html#ServiceName"><span class="hs-identifier hs-type">ServiceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span id="connect%27"><span class="annot"><span class="annottext">connect' :: String -&gt; String -&gt; String -&gt; IO Handle
</span><a href="Network.html#connect%27"><span class="hs-identifier hs-var hs-var">connect'</span></a></span></span><span> </span><span id="local-6989586621679073577"><span class="annot"><span class="annottext">caller :: String
</span><a href="#local-6989586621679073577"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679073576"><span class="annot"><span class="annottext">host :: String
</span><a href="#local-6989586621679073576"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span id="local-6989586621679073575"><span class="annot"><span class="annottext">serv :: String
</span><a href="#local-6989586621679073575"><span class="hs-identifier hs-var">serv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679073574"><span class="annot"><span class="annottext">ProtocolNumber
</span><a href="#local-6989586621679073574"><span class="hs-identifier hs-var">proto</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ProtocolNumber
</span><a href="Network.BSD.html#getProtocolNumber"><span class="hs-identifier hs-var">getProtocolNumber</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcp&quot;</span></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073572"><span class="annot"><span class="annottext">hints :: AddrInfo
</span><a href="#local-6989586621679073572"><span class="hs-identifier hs-var hs-var">hints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="Network.Socket.html#defaultHints"><span class="hs-identifier hs-var">defaultHints</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">addrFlags :: [AddrInfoFlag]
</span><a href="Network.Socket.html#addrFlags"><span class="hs-identifier hs-var">addrFlags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AddrInfoFlag
</span><a href="Network.Socket.html#AI_ADDRCONFIG"><span class="hs-identifier hs-var">AI_ADDRCONFIG</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">addrProtocol :: ProtocolNumber
</span><a href="Network.Socket.html#addrProtocol"><span class="hs-identifier hs-var">addrProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolNumber
</span><a href="#local-6989586621679073574"><span class="hs-identifier hs-var">proto</span></a></span><span>
</span><span id="line-149"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">addrSocketType :: SocketType
</span><a href="Network.Socket.html#addrSocketType"><span class="hs-identifier hs-var">addrSocketType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SocketType
</span><a href="Network.Socket.Types.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679073566"><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679073566"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe AddrInfo -&gt; Maybe String -&gt; Maybe String -&gt; IO [AddrInfo]
</span><a href="Network.Socket.html#getAddrInfo"><span class="hs-identifier hs-var">getAddrInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; Maybe AddrInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073572"><span class="hs-identifier hs-var">hints</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073576"><span class="hs-identifier hs-var">host</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073575"><span class="hs-identifier hs-var">serv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; [IO Handle] -&gt; IO Handle
forall a. String -&gt; [IO a] -&gt; IO a
</span><a href="Network.html#firstSuccessful"><span class="hs-identifier hs-var">firstSuccessful</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073577"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">([IO Handle] -&gt; IO Handle) -&gt; [IO Handle] -&gt; IO Handle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AddrInfo -&gt; IO Handle) -&gt; [AddrInfo] -&gt; [IO Handle]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AddrInfo -&gt; IO Handle
</span><a href="#local-6989586621679073563"><span class="hs-identifier hs-var">tryToConnect</span></a></span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679073566"><span class="hs-identifier hs-var">addrs</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621679073563"><span class="annot"><span class="annottext">tryToConnect :: AddrInfo -&gt; IO Handle
</span><a href="#local-6989586621679073563"><span class="hs-identifier hs-var hs-var">tryToConnect</span></a></span></span><span> </span><span id="local-6989586621679073562"><span class="annot"><span class="annottext">addr :: AddrInfo
</span><a href="#local-6989586621679073562"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">IO Socket
-&gt; (Socket -&gt; IO ()) -&gt; (Socket -&gt; IO Handle) -&gt; IO Handle
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="Network.html#bracketOnError"><span class="hs-identifier hs-var">bracketOnError</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Family -&gt; SocketType -&gt; ProtocolNumber -&gt; IO Socket
</span><a href="Network.Socket.html#socket"><span class="hs-identifier hs-var">socket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; Family
</span><a href="Network.Socket.html#addrFamily"><span class="hs-identifier hs-var hs-var">addrFamily</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073562"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; SocketType
</span><a href="Network.Socket.html#addrSocketType"><span class="hs-identifier hs-var hs-var">addrSocketType</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073562"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; ProtocolNumber
</span><a href="Network.Socket.html#addrProtocol"><span class="hs-identifier hs-var hs-var">addrProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073562"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="Network.html#sClose"><span class="hs-identifier hs-var">sClose</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- only done if there's an error</span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679073560"><span class="annot"><span class="annottext">sock :: Socket
</span><a href="#local-6989586621679073560"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>          </span><span class="annot"><span class="annottext">Socket -&gt; SockAddr -&gt; IO ()
</span><a href="Network.Socket.html#connect"><span class="hs-identifier hs-var">connect</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073560"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; SockAddr
</span><a href="Network.Socket.html#addrAddress"><span class="hs-identifier hs-var hs-var">addrAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073562"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>          </span><span class="annot"><span class="annottext">Socket -&gt; IOMode -&gt; IO Handle
</span><a href="Network.Socket.html#socketToHandle"><span class="hs-identifier hs-var">socketToHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073560"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadWriteMode</span></span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Creates the server side socket which has been bound to the</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- specified port.</span><span>
</span><span id="line-165"></span><span class="hs-comment">--</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- 'maxListenQueue' (typically 128) is specified to the listen queue.</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- This is good enough for normal network servers but is too small</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- for high performance servers.</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- To avoid the \&quot;Address already in use\&quot; problems,</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- the 'ReuseAddr' socket option is set on the listening socket.</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- If available, the 'IPv6Only' socket option is set to 0</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- so that both IPv4 and IPv6 can be accepted with this socket.</span><span>
</span><span id="line-175"></span><span class="hs-comment">--</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- If you don't like the behavior above, please use the lower level</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- 'Network.Socket.listen' instead.</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><a href="Network.html#listenOn"><span class="hs-identifier hs-type">listenOn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.html#PortID"><span class="hs-identifier hs-type">PortID</span></a></span><span>      </span><span class="hs-comment">-- ^ Port Identifier</span><span>
</span><span id="line-180"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span>   </span><span class="hs-comment">-- ^ Listening Socket</span><span class="hs-cpp">

#if defined(IPV6_SOCKET_SUPPORT)
</span><span class="hs-comment">-- IPv6 and IPv4.</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span id="listenOn"><span class="annot"><span class="annottext">listenOn :: PortID -&gt; IO Socket
</span><a href="Network.html#listenOn"><span class="hs-identifier hs-var hs-var">listenOn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.html#Service"><span class="hs-identifier hs-type">Service</span></a></span><span> </span><span id="local-6989586621679073558"><span class="annot"><span class="annottext">serv :: String
</span><a href="#local-6989586621679073558"><span class="hs-identifier hs-var">serv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Socket
</span><a href="Network.html#listen%27"><span class="hs-identifier hs-var">listen'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073558"><span class="hs-identifier hs-var">serv</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="annot"><a href="Network.html#listenOn"><span class="hs-identifier hs-var">listenOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.html#PortNumber"><span class="hs-identifier hs-type">PortNumber</span></a></span><span> </span><span id="local-6989586621679073556"><span class="annot"><span class="annottext">port :: PortNumber
</span><a href="#local-6989586621679073556"><span class="hs-identifier hs-var">port</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Socket
</span><a href="Network.html#listen%27"><span class="hs-identifier hs-var">listen'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PortNumber -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073556"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-comment">-- IPv4 only.</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-identifier">listenOn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Service</span><span> </span><span class="hs-identifier">serv</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-identifier">proto</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getProtocolNumber</span><span> </span><span class="hs-string">&quot;tcp&quot;</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-identifier">bracketOnError</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">socket</span><span> </span><span class="hs-identifier">AF_INET</span><span> </span><span class="hs-identifier">Stream</span><span> </span><span class="hs-identifier">proto</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">sClose</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">sock</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-identifier">port</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getServicePortNumber</span><span> </span><span class="hs-identifier">serv</span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-identifier">setSocketOption</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-identifier">ReuseAddr</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-identifier">bind</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SockAddrInet</span><span> </span><span class="hs-identifier">port</span><span> </span><span class="hs-identifier">iNADDR_ANY</span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>            </span><span class="hs-identifier">listen</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-identifier">maxListenQueue</span><span>
</span><span id="line-201"></span><span>            </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">sock</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-identifier">listenOn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PortNumber</span><span> </span><span class="hs-identifier">port</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-identifier">proto</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getProtocolNumber</span><span> </span><span class="hs-string">&quot;tcp&quot;</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-identifier">bracketOnError</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">socket</span><span> </span><span class="hs-identifier">AF_INET</span><span> </span><span class="hs-identifier">Stream</span><span> </span><span class="hs-identifier">proto</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">sClose</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">sock</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>            </span><span class="hs-identifier">setSocketOption</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-identifier">ReuseAddr</span><span> </span><span class="hs-number">1</span><span>
</span><span id="line-211"></span><span>            </span><span class="hs-identifier">bind</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SockAddrInet</span><span> </span><span class="hs-identifier">port</span><span> </span><span class="hs-identifier">iNADDR_ANY</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>            </span><span class="hs-identifier">listen</span><span> </span><span class="hs-identifier">sock</span><span> </span><span class="hs-identifier">maxListenQueue</span><span>
</span><span id="line-213"></span><span>            </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">sock</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if !defined(mingw32_HOST_OS)
</span><span class="annot"><a href="Network.html#listenOn"><span class="hs-identifier hs-var">listenOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.html#UnixSocket"><span class="hs-identifier hs-type">UnixSocket</span></a></span><span> </span><span id="local-6989586621679073555"><span class="annot"><span class="annottext">path :: String
</span><a href="#local-6989586621679073555"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">IO Socket
-&gt; (Socket -&gt; IO ()) -&gt; (Socket -&gt; IO Socket) -&gt; IO Socket
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="Network.html#bracketOnError"><span class="hs-identifier hs-var">bracketOnError</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Family -&gt; SocketType -&gt; ProtocolNumber -&gt; IO Socket
</span><a href="Network.Socket.html#socket"><span class="hs-identifier hs-var">socket</span></a></span><span> </span><span class="annot"><span class="annottext">Family
</span><a href="Network.Socket.Types.html#AF_UNIX"><span class="hs-identifier hs-var">AF_UNIX</span></a></span><span> </span><span class="annot"><span class="annottext">SocketType
</span><a href="Network.Socket.Types.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="Network.html#sClose"><span class="hs-identifier hs-var">sClose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679073554"><span class="annot"><span class="annottext">sock :: Socket
</span><a href="#local-6989586621679073554"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; SocketOption -&gt; Int -&gt; IO ()
</span><a href="Network.Socket.html#setSocketOption"><span class="hs-identifier hs-var">setSocketOption</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073554"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">SocketOption
</span><a href="Network.Socket.html#ReuseAddr"><span class="hs-identifier hs-var">ReuseAddr</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-224"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; SockAddr -&gt; IO ()
</span><a href="Network.Socket.html#bind"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073554"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SockAddr
</span><a href="Network.Socket.Types.html#SockAddrUnix"><span class="hs-identifier hs-var">SockAddrUnix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073555"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; Int -&gt; IO ()
</span><a href="Network.Socket.html#listen"><span class="hs-identifier hs-var">listen</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073554"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Network.Socket.html#maxListenQueue"><span class="hs-identifier hs-var">maxListenQueue</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; IO Socket
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073554"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if defined(IPV6_SOCKET_SUPPORT)
</span><span class="annot"><a href="Network.html#listen%27"><span class="hs-identifier hs-type">listen'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Socket.html#ServiceName"><span class="hs-identifier hs-type">ServiceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span id="listen%27"><span class="annot"><span class="annottext">listen' :: String -&gt; IO Socket
</span><a href="Network.html#listen%27"><span class="hs-identifier hs-var hs-var">listen'</span></a></span></span><span> </span><span id="local-6989586621679073548"><span class="annot"><span class="annottext">serv :: String
</span><a href="#local-6989586621679073548"><span class="hs-identifier hs-var">serv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679073547"><span class="annot"><span class="annottext">ProtocolNumber
</span><a href="#local-6989586621679073547"><span class="hs-identifier hs-var">proto</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ProtocolNumber
</span><a href="Network.BSD.html#getProtocolNumber"><span class="hs-identifier hs-var">getProtocolNumber</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcp&quot;</span></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-comment">-- We should probably specify addrFamily = AF_INET6 and the filter</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- code below should be removed. AI_ADDRCONFIG is probably not</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">-- necessary. But this code is well-tested. So, let's keep it.</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073546"><span class="annot"><span class="annottext">hints :: AddrInfo
</span><a href="#local-6989586621679073546"><span class="hs-identifier hs-var hs-var">hints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="Network.Socket.html#defaultHints"><span class="hs-identifier hs-var">defaultHints</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">addrFlags :: [AddrInfoFlag]
</span><a href="Network.Socket.html#addrFlags"><span class="hs-identifier hs-var">addrFlags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AddrInfoFlag
</span><a href="Network.Socket.html#AI_ADDRCONFIG"><span class="hs-identifier hs-var">AI_ADDRCONFIG</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AddrInfoFlag
</span><a href="Network.Socket.html#AI_PASSIVE"><span class="hs-identifier hs-var">AI_PASSIVE</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">addrSocketType :: SocketType
</span><a href="Network.Socket.html#addrSocketType"><span class="hs-identifier hs-var">addrSocketType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SocketType
</span><a href="Network.Socket.Types.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span>
</span><span id="line-240"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">addrProtocol :: ProtocolNumber
</span><a href="Network.Socket.html#addrProtocol"><span class="hs-identifier hs-var">addrProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolNumber
</span><a href="#local-6989586621679073547"><span class="hs-identifier hs-var">proto</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679073544"><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679073544"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe AddrInfo -&gt; Maybe String -&gt; Maybe String -&gt; IO [AddrInfo]
</span><a href="Network.Socket.html#getAddrInfo"><span class="hs-identifier hs-var">getAddrInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; Maybe AddrInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073546"><span class="hs-identifier hs-var">hints</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073548"><span class="hs-identifier hs-var">serv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">-- Choose an IPv6 socket if exists.  This ensures the socket can</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-comment">-- handle both IPv4 and IPv6 if v6only is false.</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073543"><span class="annot"><span class="annottext">addrs' :: [AddrInfo]
</span><a href="#local-6989586621679073543"><span class="hs-identifier hs-var hs-var">addrs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AddrInfo -&gt; Bool) -&gt; [AddrInfo] -&gt; [AddrInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679073542"><span class="annot"><span class="annottext">x :: AddrInfo
</span><a href="#local-6989586621679073542"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AddrInfo -&gt; Family
</span><a href="Network.Socket.html#addrFamily"><span class="hs-identifier hs-var hs-var">addrFamily</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073542"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Family -&gt; Family -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Family
</span><a href="Network.Socket.Types.html#AF_INET6"><span class="hs-identifier hs-var">AF_INET6</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679073544"><span class="hs-identifier hs-var">addrs</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span id="local-6989586621679073540"><span class="annot"><span class="annottext">addr :: AddrInfo
</span><a href="#local-6989586621679073540"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[AddrInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679073543"><span class="hs-identifier hs-var">addrs'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[AddrInfo] -&gt; AddrInfo
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679073544"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[AddrInfo] -&gt; AddrInfo
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[AddrInfo]
</span><a href="#local-6989586621679073543"><span class="hs-identifier hs-var">addrs'</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">IO Socket
-&gt; (Socket -&gt; IO ()) -&gt; (Socket -&gt; IO Socket) -&gt; IO Socket
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="Network.html#bracketOnError"><span class="hs-identifier hs-var">bracketOnError</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Family -&gt; SocketType -&gt; ProtocolNumber -&gt; IO Socket
</span><a href="Network.Socket.html#socket"><span class="hs-identifier hs-var">socket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; Family
</span><a href="Network.Socket.html#addrFamily"><span class="hs-identifier hs-var hs-var">addrFamily</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073540"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; SocketType
</span><a href="Network.Socket.html#addrSocketType"><span class="hs-identifier hs-var hs-var">addrSocketType</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073540"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; ProtocolNumber
</span><a href="Network.Socket.html#addrProtocol"><span class="hs-identifier hs-var hs-var">addrProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073540"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="Network.html#sClose"><span class="hs-identifier hs-var">sClose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679073537"><span class="annot"><span class="annottext">sock :: Socket
</span><a href="#local-6989586621679073537"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; SocketOption -&gt; Int -&gt; IO ()
</span><a href="Network.Socket.html#setSocketOption"><span class="hs-identifier hs-var">setSocketOption</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073537"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">SocketOption
</span><a href="Network.Socket.html#ReuseAddr"><span class="hs-identifier hs-var">ReuseAddr</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-251"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; SockAddr -&gt; IO ()
</span><a href="Network.Socket.html#bind"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073537"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; SockAddr
</span><a href="Network.Socket.html#addrAddress"><span class="hs-identifier hs-var hs-var">addrAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073540"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; Int -&gt; IO ()
</span><a href="Network.Socket.html#listen"><span class="hs-identifier hs-var">listen</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073537"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Network.Socket.html#maxListenQueue"><span class="hs-identifier hs-var">maxListenQueue</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; IO Socket
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073537"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- accept</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- | Accept a connection on a socket created by 'listenOn'.  Normal</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- I\/O operations (see &quot;System.IO&quot;) can be used on the 'Handle'</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- returned to communicate with the client.</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- Notice that although you can pass any Socket to Network.accept,</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- only sockets of either AF_UNIX, AF_INET, or AF_INET6 will work</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- (this shouldn't be a problem, though). When using AF_UNIX, HostName</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- will be set to the path of the socket and PortNumber to -1.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="annot"><a href="Network.html#accept"><span class="hs-identifier hs-type">accept</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span>                </span><span class="hs-comment">-- ^ Listening Socket</span><span>
</span><span id="line-269"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>              </span><span class="annot"><a href="Network.Socket.html#HostName"><span class="hs-identifier hs-type">HostName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>              </span><span class="annot"><a href="Network.Socket.Types.html#PortNumber"><span class="hs-identifier hs-type">PortNumber</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ Triple of: read\/write 'Handle' for</span><span>
</span><span id="line-272"></span><span>                                </span><span class="hs-comment">-- communicating with the client,</span><span>
</span><span id="line-273"></span><span>                                </span><span class="hs-comment">-- the 'HostName' of the peer socket, and</span><span>
</span><span id="line-274"></span><span>                                </span><span class="hs-comment">-- the 'PortNumber' of the remote connection.</span><span>
</span><span id="line-275"></span><span id="accept"><span class="annot"><span class="annottext">accept :: Socket -&gt; IO (Handle, String, PortNumber)
</span><a href="Network.html#accept"><span class="hs-identifier hs-var hs-var">accept</span></a></span></span><span> </span><span id="local-6989586621679073536"><span class="annot"><span class="annottext">sock :: Socket
</span><a href="#local-6989586621679073536"><span class="hs-identifier hs-var">sock</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#MkSocket"><span class="hs-identifier hs-type">MkSocket</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#AF_INET"><span class="hs-identifier hs-type">AF_INET</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span id="local-6989586621679073533"><span class="annot"><span class="annottext">sock' :: Socket
</span><a href="#local-6989586621679073533"><span class="hs-identifier hs-var">sock'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet"><span class="hs-identifier hs-type">SockAddrInet</span></a></span><span> </span><span id="local-6989586621679073531"><span class="annot"><span class="annottext">port :: PortNumber
</span><a href="#local-6989586621679073531"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span id="local-6989586621679073530"><span class="annot"><span class="annottext">haddr :: HostAddress
</span><a href="#local-6989586621679073530"><span class="hs-identifier hs-var">haddr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="Network.Socket.html#accept"><span class="hs-identifier hs-var">Socket.accept</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073536"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-277"></span><span> </span><span id="local-6989586621679073529"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073529"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; (IOException -&gt; IO String) -&gt; IO String
forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="Network.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a></span><span>
</span><span id="line-278"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="Network.BSD.html#HostEntry"><span class="hs-identifier hs-type">HostEntry</span></a></span><span> </span><span id="local-6989586621679073526"><span class="annot"><span class="annottext">peer :: String
</span><a href="#local-6989586621679073526"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Family -&gt; HostAddress -&gt; IO HostEntry
</span><a href="Network.BSD.html#getHostByAddr"><span class="hs-identifier hs-var">getHostByAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Family
</span><a href="Network.Socket.Types.html#AF_INET"><span class="hs-identifier hs-var">AF_INET</span></a></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621679073530"><span class="hs-identifier hs-var">haddr</span></a></span><span>
</span><span id="line-280"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073526"><span class="hs-identifier hs-var">peer</span></a></span><span>
</span><span id="line-281"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679073524"><span class="annot"><span class="annottext">_e :: IOException
</span><a href="#local-6989586621679073524"><span class="hs-identifier hs-var">_e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; IO String
</span><a href="Network.Socket.html#inet_ntoa"><span class="hs-identifier hs-var">inet_ntoa</span></a></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621679073530"><span class="hs-identifier hs-var">haddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>                </span><span class="hs-comment">-- if getHostByName fails, we fall back to the IP address</span><span>
</span><span id="line-284"></span><span> </span><span id="local-6989586621679073522"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073522"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IOMode -&gt; IO Handle
</span><a href="Network.Socket.html#socketToHandle"><span class="hs-identifier hs-var">socketToHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073533"><span class="hs-identifier hs-var">sock'</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadWriteMode</span></span><span>
</span><span id="line-285"></span><span> </span><span class="annot"><span class="annottext">(Handle, String, PortNumber) -&gt; IO (Handle, String, PortNumber)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073522"><span class="hs-identifier hs-var">handle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073529"><span class="hs-identifier hs-var">peer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073531"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(IPV6_SOCKET_SUPPORT)
</span><span class="annot"><a href="Network.html#accept"><span class="hs-identifier hs-var">accept</span></a></span><span> </span><span id="local-6989586621679073521"><span class="annot"><span class="annottext">sock :: Socket
</span><a href="#local-6989586621679073521"><span class="hs-identifier hs-var">sock</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#MkSocket"><span class="hs-identifier hs-type">MkSocket</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#AF_INET6"><span class="hs-identifier hs-type">AF_INET6</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073520"><span class="annot"><span class="annottext">sock' :: Socket
</span><a href="#local-6989586621679073520"><span class="hs-identifier hs-var">sock'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073519"><span class="annot"><span class="annottext">addr :: SockAddr
</span><a href="#local-6989586621679073519"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="Network.Socket.html#accept"><span class="hs-identifier hs-var">Socket.accept</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073521"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-289"></span><span> </span><span id="local-6989586621679073518"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073518"><span class="hs-identifier hs-var">peer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; (IOException -&gt; IO String) -&gt; IO String
forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="Network.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; String
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; String)
-&gt; ((Maybe String, Maybe String) -&gt; Maybe String)
-&gt; (Maybe String, Maybe String)
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String, Maybe String) -&gt; Maybe String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Maybe String, Maybe String) -&gt; String)
-&gt; IO (Maybe String, Maybe String) -&gt; IO String
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">[NameInfoFlag]
-&gt; Bool -&gt; Bool -&gt; SockAddr -&gt; IO (Maybe String, Maybe String)
</span><a href="Network.Socket.html#getNameInfo"><span class="hs-identifier hs-var">getNameInfo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073519"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((IOException -&gt; IO String) -&gt; IO String)
-&gt; (IOException -&gt; IO String) -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-290"></span><span>         </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073519"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-291"></span><span>                 </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet"><span class="hs-identifier hs-type">SockAddrInet</span></a></span><span>  </span><span class="hs-identifier">_</span><span>   </span><span id="local-6989586621679073515"><span class="annot"><span class="annottext">a :: HostAddress
</span><a href="#local-6989586621679073515"><span class="hs-identifier hs-var">a</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; IO String
</span><a href="Network.Socket.html#inet_ntoa"><span class="hs-identifier hs-var">inet_ntoa</span></a></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621679073515"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-292"></span><span>                 </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet6"><span class="hs-identifier hs-type">SockAddrInet6</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679073513"><span class="annot"><span class="annottext">a :: HostAddress6
</span><a href="#local-6989586621679073513"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HostAddress6 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">HostAddress6
</span><a href="#local-6989586621679073513"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>                 </span><span class="hs-identifier">SockAddrUnix</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">userError</span><span> </span><span class="hs-string">&quot;Network.accept: peer socket address 'SockAddrUnix' not supported on this platform.&quot;</span><span class="hs-cpp">
#else
</span><span>                 </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrUnix"><span class="hs-identifier hs-type">SockAddrUnix</span></a></span><span>      </span><span id="local-6989586621679073512"><span class="annot"><span class="annottext">a :: String
</span><a href="#local-6989586621679073512"><span class="hs-identifier hs-var">a</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073512"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#if defined(CAN_SOCKET_SUPPORT)
</span><span>                 </span><span class="hs-identifier">SockAddrCan</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">userError</span><span> </span><span class="hs-string">&quot;Network.accept: peer socket address 'SockAddrCan' not supported.&quot;</span><span class="hs-cpp">
#else
</span><span>                 </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrCan"><span class="hs-identifier hs-type">SockAddrCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO String
forall a. IOException -&gt; IO a
</span><span class="hs-identifier hs-var">ioError</span></span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO String) -&gt; IOException -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IOException
</span><span class="hs-identifier hs-var">userError</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Network.accept: peer socket address 'SockAddrCan' not supported on this platform.&quot;</span></span><span class="hs-cpp">
#endif
</span><span> </span><span id="local-6989586621679073508"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073508"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IOMode -&gt; IO Handle
</span><a href="Network.Socket.html#socketToHandle"><span class="hs-identifier hs-var">socketToHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073520"><span class="hs-identifier hs-var">sock'</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadWriteMode</span></span><span>
</span><span id="line-304"></span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073507"><span class="annot"><span class="annottext">port :: PortNumber
</span><a href="#local-6989586621679073507"><span class="hs-identifier hs-var hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073519"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-305"></span><span>              </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet"><span class="hs-identifier hs-type">SockAddrInet</span></a></span><span>  </span><span id="local-6989586621679073506"><span class="annot"><span class="annottext">p :: PortNumber
</span><a href="#local-6989586621679073506"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073506"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-306"></span><span>              </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet6"><span class="hs-identifier hs-type">SockAddrInet6</span></a></span><span> </span><span id="local-6989586621679073505"><span class="annot"><span class="annottext">p :: PortNumber
</span><a href="#local-6989586621679073505"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073505"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-307"></span><span>              </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-308"></span><span> </span><span class="annot"><span class="annottext">(Handle, String, PortNumber) -&gt; IO (Handle, String, PortNumber)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073508"><span class="hs-identifier hs-var">handle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073518"><span class="hs-identifier hs-var">peer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073507"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#if !defined(mingw32_HOST_OS)
</span><span class="annot"><a href="Network.html#accept"><span class="hs-identifier hs-var">accept</span></a></span><span> </span><span id="local-6989586621679073504"><span class="annot"><span class="annottext">sock :: Socket
</span><a href="#local-6989586621679073504"><span class="hs-identifier hs-var">sock</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#MkSocket"><span class="hs-identifier hs-type">MkSocket</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#AF_UNIX"><span class="hs-identifier hs-type">AF_UNIX</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span id="local-6989586621679073503"><span class="annot"><span class="annottext">sock' :: Socket
</span><a href="#local-6989586621679073503"><span class="hs-identifier hs-var">sock'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#SockAddrUnix"><span class="hs-identifier hs-type">SockAddrUnix</span></a></span><span> </span><span id="local-6989586621679073502"><span class="annot"><span class="annottext">path :: String
</span><a href="#local-6989586621679073502"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="Network.Socket.html#accept"><span class="hs-identifier hs-var">Socket.accept</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073504"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-313"></span><span> </span><span id="local-6989586621679073501"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073501"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IOMode -&gt; IO Handle
</span><a href="Network.Socket.html#socketToHandle"><span class="hs-identifier hs-var">socketToHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073503"><span class="hs-identifier hs-var">sock'</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadWriteMode</span></span><span>
</span><span id="line-314"></span><span> </span><span class="annot"><span class="annottext">(Handle, String, PortNumber) -&gt; IO (Handle, String, PortNumber)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073501"><span class="hs-identifier hs-var">handle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073502"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="annot"><a href="Network.html#accept"><span class="hs-identifier hs-var">accept</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#MkSocket"><span class="hs-identifier hs-type">MkSocket</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679073500"><span class="annot"><span class="annottext">family :: Family
</span><a href="#local-6989586621679073500"><span class="hs-keyword hs-var">family</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><span class="annottext">IOException -&gt; IO (Handle, String, PortNumber)
forall a. IOException -&gt; IO a
</span><span class="hs-identifier hs-var">ioError</span></span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO (Handle, String, PortNumber))
-&gt; IOException -&gt; IO (Handle, String, PortNumber)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IOException
</span><span class="hs-identifier hs-var">userError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IOException) -&gt; String -&gt; IOException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Network.accept: address family '&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">Family -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Family
</span><a href="#local-6989586621679073500"><span class="hs-keyword hs-var">family</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;' not supported.&quot;</span></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- | Close the socket. Sending data to or receiving data from closed socket</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- may lead to undefined behaviour.</span><span>
</span><span id="line-323"></span><span class="annot"><a href="Network.html#sClose"><span class="hs-identifier hs-type">sClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span id="sClose"><span class="annot"><span class="annottext">sClose :: Socket -&gt; IO ()
</span><a href="Network.html#sClose"><span class="hs-identifier hs-var hs-var">sClose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="Network.Socket.html#close"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="hs-comment">-- Explicit redefinition because Network.sClose is deprecated,</span><span>
</span><span id="line-325"></span><span>               </span><span class="hs-comment">-- hence the re-export would also be marked as such.</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- sendTo/recvFrom</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">{-$sendrecv
Send and receive data from\/to the given host and port number.  These
should normally only be used where the socket will not be required for
further calls. Also, note that due to the use of 'hGetContents' in 'recvFrom'
the socket will remain open (i.e. not available) even if the function already
returned. Their use is strongly discouraged except for small test-applications
or invocations from the command line.
-}</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><a href="Network.html#sendTo"><span class="hs-identifier hs-type">sendTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Socket.html#HostName"><span class="hs-identifier hs-type">HostName</span></a></span><span>      </span><span class="hs-comment">-- Hostname</span><span>
</span><span id="line-340"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.html#PortID"><span class="hs-identifier hs-type">PortID</span></a></span><span>        </span><span class="hs-comment">-- Port Number</span><span>
</span><span id="line-341"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>        </span><span class="hs-comment">-- Message to send</span><span>
</span><span id="line-342"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span id="sendTo"><span class="annot"><span class="annottext">sendTo :: String -&gt; PortID -&gt; String -&gt; IO ()
</span><a href="Network.html#sendTo"><span class="hs-identifier hs-var hs-var">sendTo</span></a></span></span><span> </span><span id="local-6989586621679073498"><span class="annot"><span class="annottext">h :: String
</span><a href="#local-6989586621679073498"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679073497"><span class="annot"><span class="annottext">p :: PortID
</span><a href="#local-6989586621679073497"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679073496"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621679073496"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>  </span><span id="local-6989586621679073495"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073495"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; PortID -&gt; IO Handle
</span><a href="Network.html#connectTo"><span class="hs-identifier hs-var">connectTo</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073498"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">PortID
</span><a href="#local-6989586621679073497"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStr</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073495"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073496"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><span class="hs-identifier hs-var">hClose</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679073495"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><a href="Network.html#recvFrom"><span class="hs-identifier hs-type">recvFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Socket.html#HostName"><span class="hs-identifier hs-type">HostName</span></a></span><span>    </span><span class="hs-comment">-- Hostname</span><span>
</span><span id="line-349"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.html#PortID"><span class="hs-identifier hs-type">PortID</span></a></span><span>      </span><span class="hs-comment">-- Port Number</span><span>
</span><span id="line-350"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>   </span><span class="hs-comment">-- Received Data</span><span class="hs-cpp">

#if defined(IPV6_SOCKET_SUPPORT)
</span><span id="recvFrom"><span class="annot"><span class="annottext">recvFrom :: String -&gt; PortID -&gt; IO String
</span><a href="Network.html#recvFrom"><span class="hs-identifier hs-var hs-var">recvFrom</span></a></span></span><span> </span><span id="local-6989586621679073492"><span class="annot"><span class="annottext">host :: String
</span><a href="#local-6989586621679073492"><span class="hs-identifier hs-var">host</span></a></span></span><span> </span><span id="local-6989586621679073491"><span class="annot"><span class="annottext">port :: PortID
</span><a href="#local-6989586621679073491"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621679073490"><span class="annot"><span class="annottext">ProtocolNumber
</span><a href="#local-6989586621679073490"><span class="hs-identifier hs-var">proto</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ProtocolNumber
</span><a href="Network.BSD.html#getProtocolNumber"><span class="hs-identifier hs-var">getProtocolNumber</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;tcp&quot;</span></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073489"><span class="annot"><span class="annottext">hints :: AddrInfo
</span><a href="#local-6989586621679073489"><span class="hs-identifier hs-var hs-var">hints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="Network.Socket.html#defaultHints"><span class="hs-identifier hs-var">defaultHints</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">addrFlags :: [AddrInfoFlag]
</span><a href="Network.Socket.html#addrFlags"><span class="hs-identifier hs-var">addrFlags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AddrInfoFlag
</span><a href="Network.Socket.html#AI_ADDRCONFIG"><span class="hs-identifier hs-var">AI_ADDRCONFIG</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-356"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">addrProtocol :: ProtocolNumber
</span><a href="Network.Socket.html#addrProtocol"><span class="hs-identifier hs-var">addrProtocol</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolNumber
</span><a href="#local-6989586621679073490"><span class="hs-identifier hs-var">proto</span></a></span><span>
</span><span id="line-357"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">addrSocketType :: SocketType
</span><a href="Network.Socket.html#addrSocketType"><span class="hs-identifier hs-var">addrSocketType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SocketType
</span><a href="Network.Socket.Types.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679073488"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679073488"><span class="hs-identifier hs-var">allowed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(AddrInfo -&gt; SockAddr) -&gt; [AddrInfo] -&gt; [SockAddr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AddrInfo -&gt; SockAddr
</span><a href="Network.Socket.html#addrAddress"><span class="hs-identifier hs-var hs-var">addrAddress</span></a></span><span> </span><span class="annot"><span class="annottext">([AddrInfo] -&gt; [SockAddr]) -&gt; IO [AddrInfo] -&gt; IO [SockAddr]
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-operator hs-var">`liftM`</span></span><span> </span><span class="annot"><span class="annottext">Maybe AddrInfo -&gt; Maybe String -&gt; Maybe String -&gt; IO [AddrInfo]
</span><a href="Network.Socket.html#getAddrInfo"><span class="hs-identifier hs-var">getAddrInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddrInfo -&gt; Maybe AddrInfo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">AddrInfo
</span><a href="#local-6989586621679073489"><span class="hs-identifier hs-var">hints</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073492"><span class="hs-identifier hs-var">host</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>                                                   </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-360"></span><span>    </span><span id="local-6989586621679073487"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073487"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PortID -&gt; IO Socket
</span><a href="Network.html#listenOn"><span class="hs-identifier hs-var">listenOn</span></a></span><span> </span><span class="annot"><span class="annottext">PortID
</span><a href="#local-6989586621679073491"><span class="hs-identifier hs-var">port</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073486"><span class="annot"><span class="annottext">waiting :: IO String
</span><a href="#local-6989586621679073486"><span class="hs-identifier hs-var hs-var">waiting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679073485"><span class="annot"><span class="annottext">s' :: Socket
</span><a href="#local-6989586621679073485"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073484"><span class="annot"><span class="annottext">addr :: SockAddr
</span><a href="#local-6989586621679073484"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="Network.Socket.html#accept"><span class="hs-identifier hs-var">Socket.accept</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073487"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073484"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; [SockAddr] -&gt; Bool
</span><a href="#local-6989586621679073482"><span class="hs-operator hs-var">`oneOf`</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679073488"><span class="hs-identifier hs-var">allowed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><a href="Network.html#sClose"><span class="hs-identifier hs-var">sClose</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073485"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO String -&gt; IO String
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="#local-6989586621679073486"><span class="hs-identifier hs-var">waiting</span></a></span><span>
</span><span id="line-365"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IOMode -&gt; IO Handle
</span><a href="Network.Socket.html#socketToHandle"><span class="hs-identifier hs-var">socketToHandle</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073485"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">ReadMode</span></span><span> </span><span class="annot"><span class="annottext">IO Handle -&gt; (Handle -&gt; IO String) -&gt; IO String
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><span class="hs-identifier hs-var">hGetContents</span></span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><span class="annottext">IO String
</span><a href="#local-6989586621679073486"><span class="hs-identifier hs-var">waiting</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621679073479"><span class="annot"><span class="annottext">a :: SockAddr
</span><a href="#local-6989586621679073479"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet"><span class="hs-identifier hs-type">SockAddrInet</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679073478"><span class="annot"><span class="annottext">ha :: HostAddress
</span><a href="#local-6989586621679073478"><span class="hs-identifier hs-var">ha</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679073482"><span class="annot"><span class="annottext">oneOf :: SockAddr -&gt; [SockAddr] -&gt; Bool
</span><a href="#local-6989586621679073482"><span class="hs-operator hs-var hs-var">`oneOf`</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet"><span class="hs-identifier hs-type">SockAddrInet</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679073477"><span class="annot"><span class="annottext">hb :: HostAddress
</span><a href="#local-6989586621679073477"><span class="hs-identifier hs-var">hb</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679073476"><span class="annot"><span class="annottext">bs :: [SockAddr]
</span><a href="#local-6989586621679073476"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621679073478"><span class="hs-identifier hs-var">ha</span></a></span><span> </span><span class="annot"><span class="annottext">HostAddress -&gt; HostAddress -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HostAddress
</span><a href="#local-6989586621679073477"><span class="hs-identifier hs-var">hb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073479"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; [SockAddr] -&gt; Bool
</span><a href="#local-6989586621679073482"><span class="hs-operator hs-var">`oneOf`</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679073476"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621679073475"><span class="annot"><span class="annottext">a :: SockAddr
</span><a href="#local-6989586621679073475"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet6"><span class="hs-identifier hs-type">SockAddrInet6</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679073474"><span class="annot"><span class="annottext">ha :: HostAddress6
</span><a href="#local-6989586621679073474"><span class="hs-identifier hs-var">ha</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679073482"><span class="hs-operator hs-var">`oneOf`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet6"><span class="hs-identifier hs-type">SockAddrInet6</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679073473"><span class="annot"><span class="annottext">hb :: HostAddress6
</span><a href="#local-6989586621679073473"><span class="hs-identifier hs-var">hb</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679073472"><span class="annot"><span class="annottext">bs :: [SockAddr]
</span><a href="#local-6989586621679073472"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HostAddress6
</span><a href="#local-6989586621679073474"><span class="hs-identifier hs-var">ha</span></a></span><span> </span><span class="annot"><span class="annottext">HostAddress6 -&gt; HostAddress6 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HostAddress6
</span><a href="#local-6989586621679073473"><span class="hs-identifier hs-var">hb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073475"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; [SockAddr] -&gt; Bool
</span><a href="#local-6989586621679073482"><span class="hs-operator hs-var">`oneOf`</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679073472"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="annot"><a href="#local-6989586621679073482"><span class="hs-operator hs-var">`oneOf`</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-cpp">
#else
</span><span class="hs-identifier">recvFrom</span><span> </span><span class="hs-identifier">host</span><span> </span><span class="hs-identifier">port</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-377"></span><span> </span><span class="hs-identifier">ip</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getHostByName</span><span> </span><span class="hs-identifier">host</span><span>
</span><span id="line-378"></span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">ipHs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hostAddresses</span><span> </span><span class="hs-identifier">ip</span><span>
</span><span id="line-379"></span><span> </span><span class="hs-identifier">s</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">listenOn</span><span> </span><span class="hs-identifier">port</span><span>
</span><span id="line-380"></span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-identifier">waiting</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>     </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-identifier">s'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">SockAddrInet</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">haddr</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="hs-identifier">Socket.accept</span><span> </span><span class="hs-identifier">s</span><span>
</span><span id="line-383"></span><span>     </span><span class="hs-identifier">he</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getHostByAddr</span><span> </span><span class="hs-identifier">AF_INET</span><span> </span><span class="hs-identifier">haddr</span><span>
</span><span id="line-384"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">any</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ipHs</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hostAddresses</span><span> </span><span class="hs-identifier">he</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-386"></span><span>         </span><span class="hs-identifier">sClose</span><span> </span><span class="hs-identifier">s'</span><span>
</span><span id="line-387"></span><span>         </span><span class="hs-identifier">waiting</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-identifier">h</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">socketToHandle</span><span> </span><span class="hs-identifier">s'</span><span> </span><span class="hs-identifier">ReadMode</span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-identifier">msg</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">hGetContents</span><span> </span><span class="hs-identifier">h</span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">msg</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span> </span><span class="hs-identifier">message</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">waiting</span><span>
</span><span id="line-394"></span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">message</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- Access function returning the port type/id of socket.</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- | Returns the 'PortID' associated with a given socket.</span><span>
</span><span id="line-401"></span><span class="annot"><a href="Network.html#socketPort"><span class="hs-identifier hs-type">socketPort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Socket.Types.html#Socket"><span class="hs-identifier hs-type">Socket</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Network.html#PortID"><span class="hs-identifier hs-type">PortID</span></a></span><span>
</span><span id="line-402"></span><span id="socketPort"><span class="annot"><span class="annottext">socketPort :: Socket -&gt; IO PortID
</span><a href="Network.html#socketPort"><span class="hs-identifier hs-var hs-var">socketPort</span></a></span></span><span> </span><span id="local-6989586621679073471"><span class="annot"><span class="annottext">s :: Socket
</span><a href="#local-6989586621679073471"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621679073470"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073470"><span class="hs-identifier hs-var">sockaddr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO SockAddr
</span><a href="Network.Socket.html#getSocketName"><span class="hs-identifier hs-var">getSocketName</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679073471"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679073470"><span class="hs-identifier hs-var">sockaddr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>      </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet"><span class="hs-identifier hs-type">SockAddrInet</span></a></span><span> </span><span id="local-6989586621679073468"><span class="annot"><span class="annottext">port :: PortNumber
</span><a href="#local-6989586621679073468"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PortID -&gt; IO PortID
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PortID -&gt; IO PortID) -&gt; PortID -&gt; IO PortID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PortNumber -&gt; PortID
</span><a href="Network.html#PortNumber"><span class="hs-identifier hs-var">PortNumber</span></a></span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073468"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-cpp">
#if defined(IPV6_SOCKET_SUPPORT)
</span><span>      </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrInet6"><span class="hs-identifier hs-type">SockAddrInet6</span></a></span><span> </span><span id="local-6989586621679073467"><span class="annot"><span class="annottext">port :: PortNumber
</span><a href="#local-6989586621679073467"><span class="hs-identifier hs-var">port</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PortID -&gt; IO PortID
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PortID -&gt; IO PortID) -&gt; PortID -&gt; IO PortID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PortNumber -&gt; PortID
</span><a href="Network.html#PortNumber"><span class="hs-identifier hs-var">PortNumber</span></a></span><span> </span><span class="annot"><span class="annottext">PortNumber
</span><a href="#local-6989586621679073467"><span class="hs-identifier hs-var">port</span></a></span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-identifier">SockAddrInet6</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">userError</span><span> </span><span class="hs-string">&quot;Network.socketPort: socket address 'SockAddrInet6' not supported on this platform.&quot;</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#if defined(mingw32_HOST_OS)
</span><span>      </span><span class="hs-identifier">SockAddrUnix</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ioError</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">userError</span><span> </span><span class="hs-string">&quot;Network.socketPort: socket address 'SockAddrUnix' not supported on this platform.&quot;</span><span class="hs-cpp">
#else
</span><span>      </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrUnix"><span class="hs-identifier hs-type">SockAddrUnix</span></a></span><span> </span><span id="local-6989586621679073466"><span class="annot"><span class="annottext">path :: String
</span><a href="#local-6989586621679073466"><span class="hs-identifier hs-var">path</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PortID -&gt; IO PortID
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(PortID -&gt; IO PortID) -&gt; PortID -&gt; IO PortID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; PortID
</span><a href="Network.html#UnixSocket"><span class="hs-identifier hs-var">UnixSocket</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073466"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-cpp">
#endif
</span><span>      </span><span class="annot"><a href="Network.Socket.Types.html#SockAddrCan"><span class="hs-identifier hs-type">SockAddrCan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO PortID
forall a. IOException -&gt; IO a
</span><span class="hs-identifier hs-var">ioError</span></span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO PortID) -&gt; IOException -&gt; IO PortID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IOException
</span><span class="hs-identifier hs-var">userError</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Network.socketPort: socket address 'SockAddrCan' not supported.&quot;</span></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- Utils</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-comment">-- Like bracket, but only performs the final action if there was an</span><span>
</span><span id="line-422"></span><span class="hs-comment">-- exception raised by the middle bit.</span><span>
</span><span id="line-423"></span><span id="local-6989586621679073684"><span id="local-6989586621679073685"><span id="local-6989586621679073686"><span class="annot"><a href="Network.html#bracketOnError"><span class="hs-identifier hs-type">bracketOnError</span></a></span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073686"><span class="hs-identifier hs-type">a</span></a></span><span>         </span><span class="hs-comment">-- ^ computation to run first (\&quot;acquire resource\&quot;)</span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679073686"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073685"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ computation to run last (\&quot;release resource\&quot;)</span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679073686"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073684"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ computation to run in-between</span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073684"><span class="hs-identifier hs-type">c</span></a></span></span></span></span><span>         </span><span class="hs-comment">-- returns the value from the in-between computation</span><span>
</span><span id="line-428"></span><span id="bracketOnError"><span class="annot"><span class="annottext">bracketOnError :: IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="Network.html#bracketOnError"><span class="hs-identifier hs-var hs-var">bracketOnError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">Exception.bracketOnError</span></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- Extra documentation</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">{-$buffering

The 'Handle' returned by 'connectTo' and 'accept' is 'NoBuffering' by
default.  For an interactive application you may want to set the
buffering mode on the 'Handle' to
'LineBuffering' or 'BlockBuffering', like so:

&gt; h &lt;- connectTo host port
&gt; hSetBuffering h LineBuffering
-}</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">{-$performance

For really fast I\/O, it might be worth looking at the 'hGetBuf' and
'hPutBuf' family of functions in &quot;System.IO&quot;.
-}</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span id="local-6989586621679073660"><span class="annot"><a href="Network.html#catchIO"><span class="hs-identifier hs-type">catchIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073660"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Exception.IOException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073660"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073660"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-cpp">
#if MIN_VERSION_base(4,0,0)
</span><span id="catchIO"><span class="annot"><span class="annottext">catchIO :: IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="Network.html#catchIO"><span class="hs-identifier hs-var hs-var">catchIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">Exception.catch</span></span><span class="hs-cpp">
#else
</span><span class="hs-identifier">catchIO</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Exception.catchJust</span><span> </span><span class="hs-identifier">Exception.ioErrors</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-457"></span><span class="hs-comment">-- Version of try implemented in terms of the locally defined catchIO</span><span>
</span><span id="line-458"></span><span id="local-6989586621679073628"><span class="annot"><a href="Network.html#tryIO"><span class="hs-identifier hs-type">tryIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073628"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exception.IOException</span></span><span> </span><span class="annot"><a href="#local-6989586621679073628"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-459"></span><span id="tryIO"><span class="annot"><span class="annottext">tryIO :: IO a -&gt; IO (Either IOException a)
</span><a href="Network.html#tryIO"><span class="hs-identifier hs-var hs-var">tryIO</span></a></span></span><span> </span><span id="local-6989586621679073462"><span class="annot"><span class="annottext">m :: IO a
</span><a href="#local-6989586621679073462"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either IOException a)
-&gt; (IOException -&gt; IO (Either IOException a))
-&gt; IO (Either IOException a)
forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="Network.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Either IOException a) -&gt; IO a -&gt; IO (Either IOException a)
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><span class="hs-identifier hs-var">liftM</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Either IOException a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679073462"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either IOException a -&gt; IO (Either IOException a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either IOException a -&gt; IO (Either IOException a))
-&gt; (IOException -&gt; Either IOException a)
-&gt; IOException
-&gt; IO (Either IOException a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Either IOException a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">-- Returns the first action from a list which does not throw an exception.</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- If all the actions throw exceptions (and the list of actions is not empty),</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- the last exception is thrown.</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- The operations are run outside of the catchIO cleanup handler because</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- catchIO masks asynchronous exceptions in the cleanup handler.</span><span>
</span><span id="line-466"></span><span class="hs-comment">-- In the case of complete failure, the last exception is actually thrown.</span><span>
</span><span id="line-467"></span><span id="local-6989586621679073675"><span class="annot"><a href="Network.html#firstSuccessful"><span class="hs-identifier hs-type">firstSuccessful</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073675"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679073675"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-468"></span><span id="firstSuccessful"><span class="annot"><span class="annottext">firstSuccessful :: String -&gt; [IO a] -&gt; IO a
</span><a href="Network.html#firstSuccessful"><span class="hs-identifier hs-var hs-var">firstSuccessful</span></a></span></span><span> </span><span id="local-6989586621679073461"><span class="annot"><span class="annottext">caller :: String
</span><a href="#local-6989586621679073461"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe IOException -&gt; [IO a] -&gt; IO a
forall b. Maybe IOException -&gt; [IO b] -&gt; IO b
</span><a href="#local-6989586621679073460"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe IOException
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-comment">-- Attempt the next operation, remember exception on failure</span><span>
</span><span id="line-471"></span><span>  </span><span id="local-6989586621679073460"><span class="annot"><span class="annottext">go :: Maybe IOException -&gt; [IO b] -&gt; IO b
</span><a href="#local-6989586621679073460"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073459"><span class="annot"><span class="annottext">p :: IO b
</span><a href="#local-6989586621679073459"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679073458"><span class="annot"><span class="annottext">ps :: [IO b]
</span><a href="#local-6989586621679073458"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679073457"><span class="annot"><span class="annottext">Either IOException b
</span><a href="#local-6989586621679073457"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO b -&gt; IO (Either IOException b)
forall a. IO a -&gt; IO (Either IOException a)
</span><a href="Network.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO b
</span><a href="#local-6989586621679073459"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-473"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException b
</span><a href="#local-6989586621679073457"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-474"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679073456"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679073456"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; IO b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679073456"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-475"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span id="local-6989586621679073455"><span class="annot"><span class="annottext">e :: IOException
</span><a href="#local-6989586621679073455"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe IOException -&gt; [IO b] -&gt; IO b
</span><a href="#local-6989586621679073460"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOException -&gt; Maybe IOException
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679073455"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[IO b]
</span><a href="#local-6989586621679073458"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-comment">-- All operations failed, throw error if one exists</span><span>
</span><span id="line-478"></span><span>  </span><span class="annot"><a href="#local-6989586621679073460"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO b
forall a. IOException -&gt; IO a
</span><span class="hs-identifier hs-var">ioError</span></span><span> </span><span class="annot"><span class="annottext">(IOException -&gt; IO b) -&gt; IOException -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IOException
</span><span class="hs-identifier hs-var">userError</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IOException) -&gt; String -&gt; IOException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073461"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: firstSuccessful: empty list&quot;</span></span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><a href="#local-6989586621679073460"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679073454"><span class="annot"><span class="annottext">e :: IOException
</span><a href="#local-6989586621679073454"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO b
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">Exception.throwIO</span></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621679073454"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-480"></span></pre></body></html>